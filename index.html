<html>
  <head>
<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
<script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
</head>


<script>
var scenelist = [
  {//scene1
    sceneref : "#hires",
    sceneyrot : 0.0, //< 360,
    transports: [
    {//port1
      pos : '0 1 -4',
      sceneIndex : 1 //index of this array to switch to
    }
    ],
    tooltips: [
    {//tip1
      pos : '2 1 -4',
      text : "#image1",
      persistTime : 3.0 //preferably in seconds
    }
    ]
  },
  {//scene2
    sceneref : "#med",
    sceneyrot : 90.0, //< 360,
    transports: [{
      pos : '3 1 4',
      sceneIndex : 0 //index of this array to switch to
    }],
    tooltips: []
  }
];
  

  AFRAME.registerComponent('change-scene-on-click', {
    schema: {
      color: {default: 'blue'},
      sceneNum: {default: '#hires'}
    },

    init: function () {
      var data = this.data;
      var el = this.el;  // <a-box>
      var defaultColor = el.getAttribute('material').color;
      var sky = document.querySelector('a-sky');

      function loadPorts(transports) {
        var boxes = document.querySelectorAll('a-box');
        for (var i=0; i< boxes.length; i++){
          //I think we can reuse the same two/three box port objects and just set their data appropriately.
          //As long as we have exactly the same number of boxes in every scene, we need no additional logic.
          //Therefore maybe we set some dummy boxes to be really small/way up in the air.
          boxes[i].setAttribute('position', transports[i].pos);
          //This line works^
          boxes[i].setAttribute('change-scene-on-click', 
            {'sceneNum' : transports[i].sceneIndex});
          //^This one doesn't?
          //The component updates according to the debugger, but the attribute doesn't. Strangely, the same is true for position but it seems to actually function normally for that component.
        }
        return;
      }

	    el.addEventListener('click', function () {
        var scene = scenelist[data.sceneNum];
        sky.setAttribute('src', scene.sceneref);
        //Set sky yaw.
        loadPorts(scene.transports);
        //Call a function to (un)load new tooltip boxes here.

      });

      el.addEventListener('mouseenter', function () {
        el.setAttribute('color', data.color);
      });

      el.addEventListener('mouseleave', function () {
        el.setAttribute('color', defaultColor);
      });
    }
  });
</script>
<body>
  <a-scene>
    <a-box color="#EF2D5E" position="0 1 -4" change-scene-on-click="sceneNum: 1">
    </a-box>

	<a-circle color="#FFFFFF" position="2 1 -4" radius=".5"
	glow="scale: 1.3; color: #FF00FF;"
	event-set__enter="_event: mouseenter; _target: #image1; visible: true"
    event-set__leave="_event: mouseleave; _target: #image1; visible: false">

		<a-image id="image1" visible="false" position="0 0 0.6" 
		height="2"
		width="2"
		align="center" src="#poi1"></a-image>
	
	</a-circle>


    <a-entity camera look-controls>
<a-entity cursor="fuse: true; fuseTimeout: 1000"
  position="0 0 -1"
  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
  material="color: black; shader: flat">
	<a-animation begin="cursor-fusing" easing="ease-in" 	attribute="scale" dur="1000"
     fill="backwards" from="1 1 1" to="0.1 0.1 0.1"></a-animation>
</a-entity>
</a-entity>
    


<a-assets>
    <img id="low"
      src="https://image.ibb.co/dczpeU/bathroom-low.jpg" crossorigin="anonymous">
    <img id="med"
      src="https://image.ibb.co/j0KKDp/bathroom-high.jpg" crossorigin="anonymous">
    <img id="hi"
      src="https://image.ibb.co/gXsNYp/bathroom-highest.jpg" crossorigin="anonymous">
    <img id="hires"
      src="https://image.ibb.co/e189af/xY-nU76w.jpg" crossorigin="anonymous">
	<img id="poi1"
	  src="https://image.ibb.co/ezKJFq/stefan-chair-black-0122106-PE278491-S4-1.jpg" crossorigin="anonymous">
</a-assets>

  <a-sky src="#hires"></a-sky>
<!-- Change the previous line to raise the camera! -->

  </a-scene>
</body>
</html>