<html>
<head>
  <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
</head>
<body>
  <a-scene>

    <!-- Warp box -->
    <a-box color="#EF2D5E" position="0 -3 -15" change-scene-on-click="sceneNum: 4">
    </a-box>

    <!-- Point of interest -->
    <a-circle color="#FFFFFF" position="2 1 -4" radius=".5"
      glow="scale: 1.3; color: #FF00FF;"
      event-set__enter="_event: mouseenter; _target: #image1; visible: true"
      event-set__leave="_event: mouseleave; _target: #image1; visible: false">

      <a-image id="image1" visible="false" position="0 0 0.6" 
        height="2" width="2" align="center" src="#poi1">
      </a-image>
    </a-circle>

    <!-- Camera -->
    <a-entity camera look-controls>
      <a-entity cursor="fuse: true; fuseTimeout: 1000"
        position="0 0 -1"
        geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
        material="color: black; shader: flat">

        <!-- Cursor -->
        <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" dur="1000"
          fill="backwards" from="1 1 1" to="0.1 0.1 0.1">
        </a-animation>

      </a-entity>
    </a-entity>
    
    <!-- First scene -->
    <a-sky src="#entrance"></a-sky>

    <!-- List of images and video -->
    <a-assets>
      <img id="low"
        src="https://image.ibb.co/dczpeU/bathroom-low.jpg" crossorigin="anonymous">
      <img id="med"
        src="https://image.ibb.co/j0KKDp/bathroom-high.jpg" crossorigin="anonymous">
      <img id="hi"
        src="https://image.ibb.co/gXsNYp/bathroom-highest.jpg" crossorigin="anonymous">
      <img id="hires" 
        src="https://image.ibb.co/e189af/xY-nU76w.jpg" crossorigin="anonymous">
      <img id="poi1"
        src="https://image.ibb.co/ezKJFq/stefan-chair-black-0122106-PE278491-S4-1.jpg" crossorigin="anonymous">
      <img id="bedroom-general"
        src="https://image.ibb.co/mJTPYV/DSCN0055.jpg" crossorigin="anonymous">
      <img id="bedroom-bed"
        src="https://image.ibb.co/maennq/DSCN0056.jpg" crossorigin="anonymous">
      <img id="hallway"
        src="https://image.ibb.co/jkvSnq/DSCN0058.jpg" crossorigin="anonymous">
      <img id="entrance"
        src=" https://image.ibb.co/ifev7q/entrance.jpg" crossorigin="anonymous">
      <img id="ground-floor"
        src="https://image.ibb.co/fedoSq/ground-floor.jpg" crossorigin="anonymous">
      <img id="elevator"
        src="https://image.ibb.co/jsZv7q/elevator.jpg" crossorigin="anonymous">
    </a-assets>

  </a-scene>

  <script>
    var scenelist = [
        {//scene1 - bathroom
          sceneref : "#hires",
          sceneyrot : 0.0, //< 360,
          transports: [
            {//port1
              pos : '0 -4 -4',
              sceneIndex : 1 //index of this array to switch to
            }
          ],
          tooltips: [
            {//tip1
              pos : '2 1 -4',
              text : "#image1",
              persistTime : 3.0 //preferably in seconds
            }
          ]
        },
        {//scene2 - bedroom general
          sceneref : "#bedroom-general",
          sceneyrot : 90.0, //< 360,
          transports: [
            {
              pos : '-7 -2 0',
              sceneIndex : 2 //index of this array to switch to
            },
            {
              pos : '-10 -2 0',
              sceneIndex : 0 //index of this array to switch to //figure out how to add two boxes in one scene
            }
          ],
          tooltips: []
        },
          {//scene3 - bed
            sceneref : "#bedroom-bed",
            sceneyrot : 90.0, //< 360,
            transports: [
              {
                pos : '7 -2 0',
                sceneIndex : 1 //index of this array to switch to
              }
            ],
            tooltips: []
          },
          {//scene4
            sceneref : "#hallway",
            sceneyrot : 90.0, //< 360,
            transports: [
              {
                pos : '-7 -2 0',
                sceneIndex : 1 //index of this array to switch to
              }
            ],
            tooltips: []
          },
          {//scene5 - ground floor
            sceneref : "#ground-floor",
            sceneyrot : 90.0, //< 360,
            transports: [
              {
                pos : '-7 -2 0',
                sceneIndex : 5 //index of this array to switch to elevator
              }
            ],
            tooltips: []
          },
          {//scene6 - elevator
            sceneref : "#elevator",
            sceneyrot : 90.0, //< 360,
            transports: [
              {
                pos : '10 -2 0',
                sceneIndex : 3 //index of this array to switch to hallway
              }
            ],
            tooltips: []
          }
      ];
        
      
    AFRAME.registerComponent('change-scene-on-click', {
      schema: {
        color: {default: 'green'},
        sceneNum: {default: 0}
      },
  
      update: function () {
        var data = this.data;
        var el = this.el;  // <a-box>
        var defaultColor = el.getAttribute('material').color;
        var sky = document.querySelector('a-sky');
  
        function loadPorts(transports) {
          var boxes = document.querySelectorAll('a-box');
          for (var i=0; i< boxes.length; i++){
            //I think we can reuse the same two/three box port objects and just set their data appropriately.
            //As long as we have exactly the same number of boxes in every scene, we need no additional logic.
            boxes[i].setAttribute('position', transports[i].pos);
            boxes[i].setAttribute('change-scene-on-click', 
              "sceneNum: " + transports[i].sceneIndex);
          }
          return;
        }
  
        el.addEventListener('click', function () {
          var scene = scenelist[data.sceneNum];
          sky.setAttribute('src', scene.sceneref);
          el.setAttribute('color', defaultColor);
          //Set sky yaw.
          loadPorts(scene.transports);
          //Call a function to (un)load new tooltip boxes here.
  
        });
  
        el.addEventListener('mouseenter', function () {
          el.setAttribute('color', data.color);
        });
  
        el.addEventListener('mouseleave', function () {
          el.setAttribute('color', defaultColor);
        });
      }
    });
  </script>
</body>
</html>